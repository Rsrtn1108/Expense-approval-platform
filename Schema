CREATE TABLE roles (
    id UUID PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE users(
    id UUID PRIMARY KEY,
    email VARCHAR(255),
    password_hash VARCHAR(255),
    role_id UUID NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_user_role
        FOREIGN KEY (role_id)
        REFERENCES roles(id)
);

CREATE TYPE expense_status AS ENUM(
    'DRAFT',
    'SUBMITTED',
    'APPROVED'.
    'REJECTED'
);

CREATE TABLE expenses (
    id UUID PRIMARY KEY,
    amount NUMERIC(10,2) NOT NULL CHECK(amount > 0),
    desc TEXT NOT NULL,
    status expense_status NOT NULL,

    submitted_by UUID NOT NULL,
    approved_by UUID,

    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_expense_submitter
        FOREIGN KEY (submitted_by)
        REFERENCES users(id),

    CONSTRAINT fk_expense_approver
        FOREIGN KEY (approved_by)
        REFERENCES users(id)
);

CREATE TABLE audit_log (
    id UUID PRIMARY KEY,
    expense_id UUID NOT NULL,
    performed_by UUID NOT NULL,
    action VARCHAR(100) NOT NULL,
    comment TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_audit_expense
        FOREIGN KEY (expense_id)
        REFERENCES expenses(id),

    CONSTRAINT fk_audit_user
        FOREIGN KEY (performed_by)
        REFERENCES users(id)
);